---
layout: post
title: Androidプログラミング入門してみた-アクティビティ編-
tags: Android
categories: Programing
---
Androidプログラミング入門してみた-アクティビティ編-
-----------------
[前回](/Programing/2012/04/02/start-android-application-architecture)のつづきです。

今回も主に書籍（[本格アプリを作ろう！ Androidプログラミングレシピ](http://www.amazon.co.jp/gp/product/4844331272/ref=as_li_ss_il?ie=UTF8&tag=modalsoul-22&linkCode=as2&camp=247&creative=7399&creativeASIN=4844331272)）を参考にして進めます。

<a href="http://www.amazon.co.jp/gp/product/4844331272/ref=as_li_ss_il?ie=UTF8&tag=modalsoul-22&linkCode=as2&camp=247&creative=7399&creativeASIN=4844331272"><img border="0" src="http://ws.assoc-amazon.jp/widgets/q?_encoding=UTF8&Format=_SL160_&ASIN=4844331272&MarketPlace=JP&ID=AsinImage&WS=1&tag=modalsoul-22&ServiceVersion=20070822" ></a><img src="http://www.assoc-amazon.jp/e/ir?t=modalsoul-22&l=as2&o=9&a=4844331272" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />

## アクティビティについて
アクティビティは、<b>android.appp.Activity</b>クラスのサブクラスによって記述される。
<b>Activity</b>のサブクラスでは、アクティビティが存続する間Androidが呼び出す、<b>ライフサイクルコールバックメソッド</b>をオーバーライドします。


#### ７つのライフサイクルコールバックメソッド

- onCreate(Bundle)

最初にアクティビティが作成されたときに呼び出されるメソッド。このメソッドは、アクティビティのユーザインタフェースを作り、その他のグローバルな初期化（バックグラウンドスレッドの作成など）を必要に応じて実行する。<b>onCreate(Bundle)</b>が呼び出された後に、<b>onStart()</b>が呼び出される。このアクティビティの前の状態が保存されていたら、<b>onCreate()</b>に<b>android.os.Bundle</b>が渡される。（無ければnull参照が渡される）

- onStart()

アクティビティをユーザに見せる直前に呼び出される。<b>onStart()</b>を呼び出した後、アクティビティがフォアグラウンドに出たときに<b>onResume()</b>を呼び出し、アクティビティが隠されるときに<b>onStop()</b>を呼び出す。

- onRestart()

停止されていたアクティビティが再スタートされる直前に呼び出される。名前の通り。<b>onRestart()</b>の後に<b>onStart()</b>が呼び出される。

- onResume()

アクティビティがユーザと対話処理を始める直前に呼び出される。このアクティビティがフォーカスを得て、ユーザの入力を受けつける。<b>onResume()</b>の呼び出し後に、そのアクティビティを中断する必要がある場合のみ<b>onPause()</b>を呼び出す。

- onPause()

別のアクティビティを再開しようとするときに呼び出される。このメソッドがリターンするまで次のアクティビティが再開されないことに注意。<b>onPause()</b>を呼び出した後、ユーザがそのアクティビティとの対話処理を再開したら<b>onResume()</b>を呼び出し、アクティビティがユーザから見えなくなったら<b>onStop()</b>を呼び出す。

- onStop()

アクティビティがユーザから見えなくなったときに呼び出される。アクティビティが破棄されたか、他のアクティビティが再開されて隠されたかのどちらかの理由で発生する。<b>onStop()</b>を呼び出した後、再びユーザとの対話処理に戻る場合は<b>onRestart()</b>を呼び出し、破棄される場合は<b>onDestroy()</b>が呼び出される。

- onDestroy()

アクティビティが破棄される前に呼び出される。ただし、メモリ不足により強制終了される場合は例外で、<b>onDestroy()</b>は呼び出されない。



これらの７つのメソッドによって、アクティビティのライフサイクル全体が定義され、３つのネストしたループが記述される。

### ３つのネストしたループ

- ライフタイム全体

最初にメソッド<b>onCreate(Bundle)</b>が呼び出されたときから、<b>onDestroy()</b>が呼び出されるまでの全ての期間。

- 可視ライフタイム

メソッド<b>onStart()</b>の呼び出しから、それに対応する<b>onStop()</b>の呼び出しまでの期間。この間、ユーザはアクティビティを画面で見られるが、アクティビティがフォアグラウンドで対話処理をしているとは限らない。

- フォアグラウンドタイム

メソッド<b>onResume()</b>の呼び出しから、それに対応する<b>onPause()</b>の呼び出しまでの期間。この間、他の全てのアクティビティより手前にあり、ユーザとの対話処理を行っている。



上記のライフサイクルを図にしたものがこれ

![アクティビティのライフサイクル](http://codezine.jp/static/images/article/4657/01.gif)


これを見てわかるように、<b>onDestroy()</b>は呼び出されない場合があるので、データ保存の処理を書いてもあてにはならない。<b>onPause()</b>の中でコミットするのが一般的。<b>onDestroy()</b>の実装では、アクティビティに割り当てられていたリソースの解放をするのが一般的。


## タスク、アクティビティスタック

- タスク

相関するアクティビティのシーケンスのこと。アクティビティスタックを提供する。

- アクティビティスタック

相関するアクティビティのシーケンスを記録する。「ヒストリースタック」「バックスタック」とも呼ばれる。

このスタックに最初にプッシュされるアクティビティは、タスクを開始したアクティビティであり、<b>ルートアクティビティ</b>と呼ぶ。実行中のアクティビティは、スタックの一番上に位置する。

実行中のアクティビティが別のアクティビティを起動すると、新しいアクティビティがスタックにプッシュされてフォーカスを得る。前のアクティビティがスタックに残り、停止状態になる。
ユーザが端末のバックボタンを押すと、現在のアクティビティがポップされて、その前のアクティビティが実行中になる。ポップされたアクティビティは破棄される。このときアクティビティが停止したときのユーザインターフェースの状態がレストアされる。

スタック内のアクティビティの順序は変わることがなく、プッシュもしくはポップされるだけ。アクティビティがスタックにプッシュされるのは、現在のアクティビティによって起動された場合のみ。スタックからポップされるのはバックボタンが押され、アクティビティの使用が終わったとき。



